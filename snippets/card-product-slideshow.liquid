<media-gallery
  id='MediaGallery-{{ section.id }}{{ id_append }}'
  role='region'
  aria-label='{{ 'products.product.media.gallery_viewer' | t }}'
>
  <slider-component
    id='GalleryThumbnails-{{ section.id }}{{ id_append }}'
    class='thumbnail-slider slider-mobile-gutter'
  >
    <ul
      id='Slider-Thumbnails-{{ section.id }}{{ id_append }}'
      class='thumbnail-list list-unstyled slider slider--mobile{% if section.settings.gallery_layout == 'thumbnail_slider' %} slider--tablet-up{% endif %}'
    >
      {%- capture sizes -%}
            (min-width: {{ settings.page_width }}px) calc(({{ settings.page_width | minus: 100 | times: media_width | round }} - 4rem) / 4),
            (min-width: 990px) calc(({{ media_width | times: 100 }}vw - 4rem) / 4),
            (min-width: 750px) calc((100vw - 15rem) / 8),
            calc((100vw - 8rem) / 3)
          {%- endcapture -%}

      {%- for media in product.media -%}
        {%- unless media.id == product.selected_or_first_available_variant.featured_media.id -%}
          {%- liquid
            capture media_index
              if media.media_type == 'model'
                increment model_index
              elsif media.media_type == 'video' or media.media_type == 'external_video'
                increment video_index
              elsif media.media_type == 'image'
                increment image_index
              endif
            endcapture
            assign media_index = media_index | plus: 1
          -%}
          <li
            id='Slide-Thumbnails-{{ section.id }}-{{ forloop.index }}{{ id_append }}'
            class='thumbnail-list__item slider__slide'
            data-target='{{ section.id }}-{{ media.id }}'
            data-media-position='{{ media_index }}'
          >
            {%- if media.media_type == 'model' -%}
              <span class='thumbnail__badge' aria-hidden='true'>
                {%- render 'icon-3d-model' -%}
              </span>
            {%- elsif media.media_type == 'video' or media.media_type == 'external_video' -%}
              <span class='thumbnail__badge' aria-hidden='true'>
                {%- render 'icon-play' -%}
              </span>
            {%- endif -%}
            {%- capture thumbnail_id -%}
                  Thumbnail-{{ section.id }}-{{ forloop.index }}{{ id_append }}
                {%- endcapture -%}
            <button
              class='thumbnail global-media-settings global-media-settings--no-shadow'
              aria-label='{%- if media.media_type == 'image' -%}{{ 'products.product.media.load_image' | t: index: media_index }}{%- elsif media.media_type == 'model' -%}{{ 'products.product.media.load_model' | t: index: media_index }}{%- elsif media.media_type == 'video' or media.media_type == 'external_video' -%}{{ 'products.product.media.load_video' | t: index: media_index }}{%- endif -%}'
              {% if media == product.selected_or_first_available_variant.featured_media
                or product.selected_or_first_available_variant.featured_media == null
                and forloop.index == 1
              %}
                aria-current='true'
              {% endif %}
              aria-controls='GalleryViewer-{{ section.id }}{{ id_append }}'
              aria-describedby='{{ thumbnail_id }}'
            >
              {{
                media.preview_image
                | image_url: width: 416
                | image_tag:
                  loading: 'lazy',
                  sizes: sizes,
                  widths: '54, 74, 104, 162, 208, 324, 416',
                  id: thumbnail_id,
                  alt: media.alt
                | escape
              }}
            </button>
          </li>
        {%- endunless -%}
      {%- endfor -%}
    </ul>
  </slider-component>
</media-gallery>
